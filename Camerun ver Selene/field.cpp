//*============================================================================
//field.cpp
//*============================================================================

//=============================================================================
//include
//=============================================================================
#include "field.h"

//=============================================================================
//コンストラクタ
//=============================================================================
//[input]
//	name:データ名
//=============================================================================
CField::CField( string name ) : m_pMapModel(NULL)
{
	m_DataName = name;
	m_eType = OBJ_MAP;
	
	m_IsVisible = true;
	
	m_vPos.Set(0, -1, 0);
	m_vRot.Set(0, 0, 0);
	
	m_vScale.Set(1.0f, 1.0f, 1.0f);
	
	for( int numActor = 0;numActor < S_MAX;++numActor )
	{
		m_pActorMap[numActor] = NULL;
	}
	
	m_ActorIndex = 0;
	
}


//=============================================================================
//デストラクタ
//=============================================================================
CField::~CField()
{
	for( int numActor = 0;numActor < S_MAX;++numActor )
	{
		SAFE_RELEASE( m_pActorMap[numActor] );
	}
	
	SAFE_RELEASE( m_pMapModel );
	
}

//=============================================================================
//初期化
//=============================================================================
void CField::Init()
{
	
}

//=============================================================================
//処理
//=============================================================================
void CField::Exec()
{

}

//=============================================================================
//レンダリング
//=============================================================================
//[input]
//	index:インデックスに設定する値
//=============================================================================
void CField::Rendering( int index )
{
	
	
	m_pActorMap[index]->RenderingRequest();
}

//=============================================================================
//ファイル読み込み
//=============================================================================
//[input]
//	render:レンダリング用デバイス
//=============================================================================
void CField::Load( Renderer::IRender *pRender )
{
	if( !m_DataName.empty() )
	{	
		m_pMapModel = pRender->CreateMapModelFromFile( m_DataName.c_str() );
	}
	
}

//==============================================================================
//アクターの生成
//==============================================================================
//[input]
//	pSceneMgr:シーン管理デバイス
//==============================================================================
void CField::CreateActor( int index, Scene::ISceneManager *pSceneMgr )
{
	if( m_pMapModel != NULL )
	{
		m_pActorMap[index] = pSceneMgr->CreateActor( m_pMapModel );
		
		#if defined( DEBUG ) | (_DEBUG )
			
			m_pActorMap[index]->CreateCollisionDrawPrimitive( m_pLine );
			
		#endif
	}
	
}

//=============================================================================
//剛体モデルの生成
//=============================================================================
//[input]
//	pWorld:物理シミュレーション用デバイス
//=============================================================================
void CField::CreateRigidModel( Dynamics::ISimulationWorld *pWorld )
{
	m_pRigidModel = pWorld->CreateMap( m_pMapModel );
}


//==============================================================================
//アクターの生成
//==============================================================================
//[input]
//	pSceneMgr:シーン管理デバイス
//==============================================================================
//void CField::CreateActor( int index, Scene::ICustomizedSceneManager *pSceneMgr )
//{
//	if( m_pMapModel != NULL )
//	{
//		m_pActorMap[index] = pSceneMgr->CreateActor( m_pMapModel );
//	}
//}


//=============================================================================
//アクターインデックスのセット
//=============================================================================
//[input]
//	index:インデックスに設定する値
//=============================================================================
void CField::SetActorIndex( int index )
{
	m_ActorIndex = index;
}


//=============================================================================
//マップアクターのセット
//=============================================================================
//[input]
//	style:姿勢データ
//=============================================================================
//void CField::SetActor( Math::Style *pStyle )
//{
//	if( m_pMapModel != NULL )
//	{
//		m_pActorMap = dynamic_cast<Scene::IMapActor *>(pStyle);
//	}
//}









